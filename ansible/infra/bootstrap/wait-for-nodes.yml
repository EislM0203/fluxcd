---
- name: Wait for nodes to be ready
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Wait for SSH to be available on all hosts
      ansible.builtin.wait_for:
        host: "{{ hostvars[item].ansible_host }}"
        port: 22
        delay: 10
        timeout: 300
        state: started
      loop: "{{ groups['all'] }}"
      when: hostvars[item].ansible_host is defined
      tags: [bootstrap, connectivity]
